<% if @product.nil? %>

	Product not found!

<% else %>

	<div>

		<%= render "show_visual_head" %>

		<br/>
		<br/>
		<br/>
		<br/>
		<div>
  		<div style="display: block; width: 50%; margin: auto;" >
  			<%= form_tag("/package/follow", :remote => true) do  %>
  				<label>Scope </label>
  				<% if @product.prod_type.eql?("RubyGem") %> 
						<select name="scope" style="width: 150px;" onchange="render_wheel(this.value)" >
							<option value="all" selected >all</option>
							<option value="runtime"  >runtime</option>
		          <option value="test" >test</option>
		          <option value="development" >development</option>
		        </select>
					<% elsif @product.prod_type.eql?("Maven2") %>
						<select name="scope" style="width: 150px;" onchange="render_wheel(this.value)" >
							<option value="all" selected >all</option>
							<option value="compile" >compile</option>
		          <option value="test" >test</option>
		          <option value="provided" >provided</option>
		        </select>
					<% elsif @product.prod_type.eql?("npm") %>
						<select name="scope" style="width: 150px;" onchange="render_wheel(this.value)" >
							<option value="all" selected >all</option>
							<option value="compile" >compile</option>
		          <option value="development" >development</option>
		        </select>
					<% elsif @product.prod_type.eql?("Packagist") %>
						<select name="scope" style="width: 150px;" onchange="render_wheel(this.value)" >
							<option value="all" selected >all</option>
							<option value="require"  >require</option>
		          <option value="require-dev" >require-dev</option>
		          <option value="replace" >replace</option>
		        </select>
					<% end %>
					<input id="product_key_hidden"  name="product_key" type="hidden" value="<%= @product.to_param %>" />
				<% end %>
  		</div>
  	</div>

		<div id="canvas-container" ></div>
		<div>
			<h3 style="text-align: center; display: none; width: 100%" id="infoBox" >
				<span >
					<a id="pinit" style="display: none;" href="" class="pin-it-button" count-layout="horizontal"><img border="0" alt="pint_it_on_pinterest" src="//assets.pinterest.com/images/PinExt.png" title="Pin It" /></a>
				</span><br/>
				<br/>
				<%= @product.name %> has <span style="font-weight: bold;" id="recursive_number"></span> recursive <span id="scope_name"><%= @product.main_scope %></span> dependencies
			</h3>
		</div>
		<div style="text-align: center;">
			<a href="/package/<%=@product.to_param%>/version/<%=@version.to_url_param%>">See more details</a>
		</div>
		<br/>
		<br/>

		<script type="text/javascript">
			function render_wheel(scope){
				if (scope == null){
					scope = "all"
				}
				uri = "/package/<%= @product.to_param%>/version/<%= @product.version_to_url_param %>/dependencies.json?scope=" + scope;
				var wheel = new DependencyWheel.Remote(false, document.getElementById("canvas-container"), { 
					url: uri,
					width: "750", 
					height: "750",
					data_border: 70,
					infoBox: "infoBox",
					infoNumber: "recursive_number",
					canvas_id: "canvas",
					canvas_hover_id: "canvas_hover",
					product_key: "<%= @product.to_param%>", 
					product_version: "<%= @product.version_to_url_param%>",
					product_name: "<%= @product.name%>", 
					version: "<%= @product.version%>",
					show_label: false,
					resize: true,
					resize_factor: 11,
					resize_ids: "section,container",
					container_id: "canvas-container",
					scope: scope,
					onItemClick: function(item, event){
						key = item.id; 
						key = key.replace(/\//g, "--");
						key = key.replace(/\./g, "~" );
						version = item.version;
						version = version.replace(/\//g, "--");
						version = version.replace(/\./g, "~" );
						window.location.href = "/package/" + key + "/version/" + version;
					}
				} );
			}	
		</script>

	</div>
	
<% end %>